@page "/game/{gameId:guid}/matchmaking"
@model MatchmakingModel

@{
    Layout = "_GameLayout";
}

<div class="container-fluid">
    <!-- Page title -->
    <div class="row">
        <div class="col-12">
            <div class="page-title-box d-sm-flex align-items-center justify-content-between bg-galaxy-transparent">
                <h4 class="mb-sm-0">Matchmaking</h4>
                <div class="page-title-right">
                    <ol class="breadcrumb m-0">
                        <li class="breadcrumb-item">
                            <a href="/games">Games</a>
                        </li>
                        <li class="breadcrumb-item">
                            <a href="/game/@Model.GameId">@Model.Game.Name</a>
                        </li>
                        <li class="breadcrumb-item active">Matchmaking</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="row mb-4">
        <div class="col-xl-3 col-md-6">
            <div class="card card-animate">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <h6 class="text-muted mb-3">Active Queues</h6>
                            @* <h2 class="mb-0">@Model.Stats.ActiveQueues</h2> *@
                        </div>
                        <div class="flex-shrink-0 avatar-sm">
                            <span class="avatar-title bg-primary-subtle text-primary rounded fs-3">
                                <i class="ri-queue-line"></i>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="card card-animate">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <h6 class="text-muted mb-3">Pending Tickets (24h)</h6>
                            @* <h2 class="mb-0">@Model.Stats.PendingTickets</h2> *@
                        </div>
                        <div class="flex-shrink-0 avatar-sm">
                            <span class="avatar-title bg-warning-subtle text-warning rounded fs-3">
                                <i class="ri-time-line"></i>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="card card-animate">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <h6 class="text-muted mb-3">Matches Created (24h)</h6>
                            @* <h2 class="mb-0">@Model.Stats.MatchesCreated</h2> *@
                        </div>
                        <div class="flex-shrink-0 avatar-sm">
                            <span class="avatar-title bg-success-subtle text-success rounded fs-3">
                                <i class="ri-game-line"></i>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="card card-animate">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <h6 class="text-muted mb-3">Avg. Match Time</h6>
                            @* <h2 class="mb-0">@Model.Stats.AverageMatchTime.ToString("0.0")s</h2> *@
                        </div>
                        <div class="flex-shrink-0 avatar-sm">
                            <span class="avatar-title bg-info-subtle text-info rounded fs-3">
                                <i class="ri-timer-line"></i>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Queues List -->
    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-header d-flex align-items-center">
                    <h5 class="card-title flex-grow-1 mb-0">Matchmaking Queues</h5>
                    <div class="d-flex gap-2">
                        <div class="search-box">
                            <input type="text" class="form-control search" placeholder="Search queues...">
                            <i class="ri-search-line search-icon"></i>
                        </div>
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createQueueModal">
                            <i class="ri-add-line align-bottom me-1"></i> Create Queue
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-nowrap align-middle mb-0">
                            <thead class="table-light">
                            <tr>
                                <th scope="col">Queue Name</th>
                                <th scope="col">Type</th>
                                <th scope="col">Players/Team</th>
                                <th scope="col">Teams/Match</th>
                                <th scope="col">Status</th>
                                <th scope="col">Active Tickets</th>
                                <th scope="col">Actions</th>
                            </tr>
                            </thead>
                            <tbody>
                            @* @foreach (var queue in Model.Queues) *@
                            @* { *@
                            @*     <tr> *@
                            @*         <td> *@
                            @*             <div class="d-flex align-items-center"> *@
                            @*                 <div class="flex-shrink-0"> *@
                            @*                     <div class="avatar-sm"> *@
                            @*                         <span class="avatar-title bg-primary-subtle text-primary rounded"> *@
                            @*                             <i class="ri-queue-line"></i> *@
                            @*                         </span> *@
                            @*                     </div> *@
                            @*                 </div> *@
                            @*                 <div class="flex-grow-1 ms-3"> *@
                            @*                     <h5 class="fs-14 mb-1">@queue.Name</h5> *@
                            @*                     <p class="text-muted mb-0">@queue.Description</p> *@
                            @*                 </div> *@
                            @*             </div> *@
                            @*         </td> *@
                            @*         <td>@queue.Type</td> *@
                            @*         <td>@queue.PlayersPerTeam</td> *@
                            @*         <td>@queue.TeamsPerMatch</td> *@
                            @*         <td> *@
                            @*             <div class="form-check form-switch form-switch-success"> *@
                            @*                 <input class="form-check-input" type="checkbox" role="switch" *@
                            @*                        id="queue-@queue.Id" @(queue.IsEnabled ? "checked" : "")> *@
                            @*             </div> *@
                            @*         </td> *@
                            @*         <td> *@
                            @*             <span class="badge bg-success-subtle text-success"> *@
                            @*                 @queue.ActiveTickets Active *@
                            @*             </span> *@
                            @*         </td> *@
                            @*         <td> *@
                            @*             <div class="dropdown"> *@
                            @*                 <button class="btn btn-soft-secondary btn-sm dropdown" type="button" data-bs-toggle="dropdown"> *@
                            @*                     <i class="ri-more-fill align-middle"></i> *@
                            @*                 </button> *@
                            @*                 <ul class="dropdown-menu dropdown-menu-end"> *@
                            @*                     <li> *@
                            @*                         <a class="dropdown-item" href="/game/@Model.GameId/matchmaking/@queue.Id"> *@
                            @*                             <i class="ri-eye-fill align-bottom me-2 text-muted"></i> View Details *@
                            @*                         </a> *@
                            @*                     </li> *@
                            @*                     <li> *@
                            @*                         <button class="dropdown-item edit-queue" data-id="@queue.Id"> *@
                            @*                             <i class="ri-pencil-fill align-bottom me-2 text-muted"></i> Edit Queue *@
                            @*                         </button> *@
                            @*                     </li> *@
                            @*                     <li class="dropdown-divider"></li> *@
                            @*                     <li> *@
                            @*                         <button class="dropdown-item text-danger delete-queue" data-id="@queue.Id"> *@
                            @*                             <i class="ri-delete-bin-fill align-bottom me-2"></i> Delete Queue *@
                            @*                         </button> *@
                            @*                     </li> *@
                            @*                 </ul> *@
                            @*             </div> *@
                            @*         </td> *@
                            @*     </tr> *@
                            @* } *@
                            </tbody>
                        </table>
                    </div>

                    @* @if (!Model.Queues.Any()) *@
                    {
                        <div class="text-center p-4">
                            <div class="avatar-lg mx-auto mb-4">
                                <div class="avatar-title bg-primary-subtle text-primary rounded-circle fs-24">
                                    <i class="ri-queue-line"></i>
                                </div>
                            </div>
                            <h5>No Matchmaking Queues</h5>
                            <p class="text-muted">Get started by creating your first matchmaking queue.</p>
                            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createQueueModal">
                                <i class="ri-add-line align-bottom me-1"></i> Create Queue
                            </button>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Create/Edit Queue Modal -->
<div class="modal fade" id="createQueueModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Create Matchmaking Queue</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="queueForm" class="needs-validation" novalidate>
                    <input type="hidden" id="queueId" name="id">

                    <!-- Basic Info -->
                    <div class="mb-4">
                        <h6 class="fw-semibold">Basic Information</h6>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Queue Name</label>
                                <input type="text" class="form-control" name="name" required
                                       placeholder="e.g., Ranked 2v2">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Queue Type</label>
                                <select class="form-select" name="type" required>
                                    <option value="Standard">Standard</option>
                                    <option value="Ranked">Ranked</option>
                                    <option value="Tournament">Tournament</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Description</label>
                                <textarea class="form-control" name="description" rows="2"
                                          placeholder="Brief description of this queue"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Match Configuration -->
                    <div class="mb-4">
                        <h6 class="fw-semibold">Match Configuration</h6>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Players per Team</label>
                                <input type="number" class="form-control" name="playersPerTeam"
                                       min="1" max="32" value="2" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Teams per Match</label>
                                <input type="number" class="form-control" name="teamsPerMatch"
                                       min="2" max="16" value="2" required>
                            </div>
                        </div>
                    </div>

                    <!-- Matchmaking Rules -->
                    <div class="mb-4">
                        <h6 class="fw-semibold">Matchmaking Rules</h6>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Maximum Wait Time (seconds)</label>
                                <input type="number" class="form-control" name="maxWaitTime"
                                       min="10" max="300" value="60" required>
                                <div class="form-text">Maximum time to wait before relaxing match criteria</div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Skill Rating Difference</label>
                                <input type="number" class="form-control" name="skillDifference"
                                       min="0" max="1000" value="100">
                                <div class="form-text">Maximum allowed skill rating difference between players</div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Region Selection</label>
                                <select class="form-select" name="regionPreference">
                                    <option value="auto">Auto (Lowest Latency)</option>
                                    <option value="strict">Strict (Selected Region Only)</option>
                                    <option value="flexible">Flexible (Allow Nearby Regions)</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Match Start Behavior</label>
                                <select class="form-select" name="matchStartBehavior">
                                    <option value="full">Wait for Full Teams</option>
                                    <option value="minimum">Start with Minimum Players</option>
                                    <option value="scheduled">Scheduled Start Time</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Team Balancing -->
                    <div class="mb-4">
                        <h6 class="fw-semibold">Team Balancing</h6>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Team Formation Strategy</label>
                                <select class="form-select" name="teamFormation">
                                    <option value="balanced">Balanced (Even Distribution)</option>
                                    <option value="skilled">Skill-based (Similar Ratings)</option>
                                    <option value="random">Random Assignment</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Party Handling</label>
                                <select class="form-select" name="partyHandling">
                                    <option value="keep">Keep Parties Together</option>
                                    <option value="split">Allow Party Splits</option>
                                    <option value="none">No Party Support</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Options -->
                    <div class="mb-4">
                        <h6 class="fw-semibold">Additional Options</h6>
                        <div class="row g-3">
                            <div class="col-md-12">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" name="allowParties" checked>
                                    <label class="form-check-label">Allow Party Matchmaking</label>
                                    <small class="form-text d-block">Enable players to queue as a party</small>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" name="backfillEnabled">
                                    <label class="form-check-label">Enable Match Backfilling</label>
                                    <small class="form-text d-block">Allow players to join ongoing matches</small>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" name="autoBalance">
                                    <label class="form-check-label">Auto Team Balance</label>
                                    <small class="form-text d-block">Automatically balance teams during match</small>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" name="enabled" checked>
                                    <label class="form-check-label">Enable Queue</label>
                                    <small class="form-text d-block">Allow players to join this queue</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveQueue">
                    <i class="ri-save-line align-bottom me-1"></i> Save Queue
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteQueueModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Delete Queue</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center">
                <div class="mt-4">
                    <lord-icon src="https://cdn.lordicon.com/gsqxdxog.json"
                               trigger="loop" colors="primary:#f7b84b,secondary:#f06548"
                               style="width:100px;height:100px">
                    </lord-icon>
                    <div class="mt-4 pt-2 fs-15 mx-4 mx-sm-5">
                        <h4>Are you sure?</h4>
                        <p class="text-muted mx-4 mb-0">
                            Are you sure you want to delete this queue? This action cannot be undone
                            and will remove all associated matchmaking data.
                        </p>
                    </div>
                </div>
                <div class="d-flex gap-2 justify-content-center mt-4 mb-2">
                    <button type="button" class="btn w-sm btn-light" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn w-sm btn-danger" id="deleteQueueBtn">Yes, Delete It!</button>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/pages/matchmaking.js"></script>
}
